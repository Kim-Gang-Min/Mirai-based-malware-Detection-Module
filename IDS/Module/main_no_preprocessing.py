import scan_traffic as ids
import model_check_no_preprocessing as mdc
import client as srv
import os
#import get_user as gusr
from requests import get
#import requests
import torch
import torch.nn as nn
import torch.utils.data
from torch.utils.data import Dataset, DataLoader

class NeuralNetwork(nn.Module):
    def __init__(self):
        super(NeuralNetwork, self).__init__()
        self.linear_relu_stack = nn.Sequential(
            nn.Linear(in_features=6, out_features=256),
            nn.ReLU(),
            nn.Linear(in_features=256, out_features=512),
            nn.ReLU(),
            nn.Linear(in_features=512, out_features=1),
            #nn.ReLU()
        )

    def forward(self, x):
        output = self.linear_relu_stack(x)
        return output


class LstmModel(nn.Module):
    def __init__(self, b_size):
        super(LstmModel, self).__init__()
        self.lstm = nn.LSTM(input_size=7, hidden_size=256, num_layers=7*15, batch_first=True)
        self.linear_relu_stack = nn.Sequential(
            nn.Linear(in_features=256, out_features=512),
            nn.ReLU(),
            nn.Linear(in_features=512, out_features=256),
            nn.ReLU(),
            nn.Linear(in_features=256, out_features=1),
            nn.ReLU()
        )

    def forward(self, x):
        hidden, _ = self.lstm(x)
        output = self.linear_relu_stack(hidden)
        return output

if __name__ == "__main__":
    #host_ip = get("https://api.ipify.org").text
    print("Select type of traffic (0: exit, 1: Network, 2: pcap)")
    in_chk = True
    while(in_chk):
        type_traffic = input()
        if type_traffic == '0':
            print("Exit proccess")
            exit(0)
        elif type_traffic == '1':
            print("Scan this network!")
            in_chk = False
        elif type_traffic == '2':
            print("Read pcap!")
            in_chk = False
        else:
            print("Please select in (0: exit, 1: Network, 2: pcap)")
    
    
    result = False
    #c_socket = srv.connection_server()
    
    while(True):
        traffic, seq_list = ids.scan_data(type_traffic)
        
        #if os.fork() == 0:
        if True:
            #err = srv.check_server(c_socket)
                       
            #if err:
            #    print("Can't connect to secure server!")

            atk_df, result= mdc.check_attack(traffic, seq_list)
            
            #if result == True:
            #    gusr.inform_user()
            #    srv.send_to_server(c_socket, bad_traffic)
            #else :
            #    srv.send_to_server_no_scan(c_socket)
            exit(0)#child process down
        
        print("restart scan data")
                
        
        
            
